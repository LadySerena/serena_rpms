/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

task downloadNodeExporter(type: Download){
  src nodeExporterUrl
  dest buildDir
  overwrite false
}

task untarNodeExporter(type: Copy){
  dependsOn downloadNodeExporter
  from tarTree("${buildDir}/node_exporter-0.18.1.linux-amd64.tar.gz")
  into buildDir
}

task buildNodeExporter(type: Rpm) {
  dependsOn untarNodeExporter
  packageName 'nodeExporter'
  version '0.18.1'
  release '1'
  preInstall file('scripts/preInstall.sh')
  postInstall file('scripts/postInstall.sh')
  arch 'X86_64'
  os 'Linux'
  from("${buildDir}/node_exporter-0.18.1.linux-amd64") {
    user = 'root'
    permissionGroup = 'root'
    fileMode = 0751
    include 'node_exporter'
    into '/usr/sbin'
  }
  from('etc/systemd/'){
    into '/etc/systemd/system/'
    user 'root'
    permissionGroup 'root'
    fileMode 0644
  }

}

build {
  dependsOn buildNodeExporter
}
